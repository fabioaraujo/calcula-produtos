<html>
    <head>
    <script src="/js/jquery-3.2.1.js"></script>
    <script>
	    $(document).ready(function(){
	    	$.get( "/hora/get", function( data ) {
	    		  console.log(data);
	    		  if(data){
	    			  $("#horaTrabalhada").val(data.custo);
	    		  }
	    		});
	    	
	    	carregaTabelaItens();
	    	carregaComboItens();
	    	carregaTabelaProdutos();
	    });
	    
	    var carregaTabelaItens = function(){
	    	$("#itens tbody").empty();
	    	$.get( "/item/listar", function( data ) {
	    		  console.log(data);
	    		  for(idx in data){
	    			  $("#itens tbody").append("<tr><td>" + data[idx].id + "</td><td>" + data[idx].nome + "</td><td>" + data[idx].tipoUnidade + "</td><td>" + data[idx].custo + 
	    					  "</td><td><a href='#' onclick='editarItem(" + data[idx].id + ")'>Editar</a></td></tr>");
	    		  }
	    		});
	    }

	    var carregaComboItens = function(){
	        $("#itensCombo").empty();
	    	$.get( "/item/listar", function( data ) {
              console.log(data);
             $.each(data,function(idx, json){
                    $("#itensCombo").append('<option value=' + json.id + '>' + json.nome + '</option>');
                });
            });
	    };
	    
	    var carregaTabelaProdutos = function(){
	    	$("#produtos tbody").empty();
	    	$.get( "/produto/listar", function( data ) {
	    		  console.log("produto/listar" + data);
	    		  for(idx in data){
	    			  $("#produtos tbody").append("<tr><td>" + data[idx].id + "</td><td>" + data[idx].nome + "</td><td>" + data[idx].horasTrabalhadas + "</td><td>" + data[idx].custoTotal + 
	    					  "</td><td><a href='#' onclick='editarProduto(" + data[idx].id + ")'>Editar</a></td></tr>");
	    		  }
	    		});
	    }
	    
	    var atualizaHora = function(){
	    	$.ajax({
	    	    type: 'POST',
	    	    url: '/hora/atualizar',
	    	    data: '{"id" : 0, "custo": ' + $("#horaTrabalhada").val() + '}', // or JSON.stringify ({name: 'jonas'}),
	    	    success: function(data) { 
	    	    	console.log(data);
		    		  if(data){
		    			  $("#horaTrabalhada").val(data.custo);
		    		  }
	    	    },
	    	    contentType: "application/json",
	    	    dataType: 'json'
	    	});
	    	
	    };
	    
	    var criaItem = function(){
	    	console.log('{"id": ' + $('#formItem').find('input[name="id"]').val() + ', "nome": "' + $('#formItem').find('input[name="nome"]').val() + 
	    	    	'", "tipoUnidade": "' + $('#formItem').find('#tipoUnidadeItem option:selected').val() + '", "custo": ' + $('#formItem').find('input[name="custo"]').val() + '}');
	    	$.ajax({
	    	    type: 'POST',
	    	    url: '/item/criar',
	    	    data: '{"id": ' + $('#formItem').find('input[name="id"]').val() + ', "nome": "' + $('#formItem').find('input[name="nome"]').val() + 
	    	    	'", "tipoUnidade": "' + $('#formItem').find('#tipoUnidadeItem option:selected').val() + '", "custo": ' + $('#formItem').find('input[name="custo"]').val() + '}', // or JSON.stringify ({name: 'jonas'}),
	    	    success: function(data) { 
	    	    	console.log(data);
	    	    	carregaTabelaItens();
	    	    	carregaComboItens();
	    	    	 limparItem();
	    	    	
	    	    },
	    	    contentType: "application/json",
	    	    dataType: 'json'
	    	});
	    	
	    };
	    
	    var criaProduto = function(){
	    	console.log('{"id": ' + $('#formProduto').find('input[name="id"]').val() + ', "nome": "' + $('#formProduto').find('input[name="nome"]').val() + 
	    	    	'", "horasTrabalhadas": ' + $('#formProduto').find('input[name="horasTrabalhadas"]').val() + '}');
	    	$.ajax({
	    	    type: 'POST',
	    	    url: '/produto/criar',
	    	    data: '{"id": ' + $('#formProduto').find('input[name="id"]').val() + ', "nome": "' + $('#formProduto').find('input[name="nome"]').val() + 
    	    	'", "horasTrabalhadas": ' + $('#formProduto').find('input[name="horasTrabalhadas"]').val() + '}', // or JSON.stringify ({name: 'jonas'}),
	    	    success: function(data) { 
	    	    	console.log(data);
	    	    	carregaTabelaProdutos();
	    	    	 limparProduto();
	    	    	
	    	    },
	    	    contentType: "application/json",
	    	    dataType: 'json'
	    	});
	    	
	    };
	    
	    var limparItem = function(){
	    	$('#formItem').find("input[type=text], textarea, select").val("");
	    };
	    
	    var limparProduto = function(){
	    	$('#formProduto').find("input[type=text], textarea, select").val("");
	    };
	    
	    var editarItem = function(id){
	    	$.get( "/item/getById?id=" + id, function( data ) {
		    		  console.log(data);
		    		  $('#formItem').find('input[name="id"]').val(data.id);
		    		  $('#formItem').find('input[name="nome"]').val(data.nome); 
		  	    	  $('#formItem').find('#tipoUnidadeItem').val(data.tipoUnidade);
		  	    	  $('#formItem').find('input[name="custo"]').val(data.custo);
	    		});
	    };
	    
	    var editarProduto = function(id){
	    	$.get( "/produto/getById?id=" + id, function( data ) {
		    		  console.log(data);
		    		  $('#formProduto').find('input[name="id"]').val(data.id);
		    		  $('#formProduto').find('input[name="nome"]').val(data.nome); 
		  	    	  $('#formProduto').find('input[name="horasTrabalhadas"]').val(data.horasTrabalhadas);
		  	    	  $('#formProduto').find('input[name="custoTotal"]').val(data.custoTotal);
	    		});
	    };
	    
	    function getFormData($form){
	        var unindexed_array = $form.serializeArray();
	        var indexed_array = {};

	        $.map(unindexed_array, function(n, i){
	            indexed_array['"'+n['name']+'"'] = n['value'];
	        });

	        return indexed_array;
	    }
    </script>
    </head>
    <body>
        <h1>C&aacute;lcula Produtos</h1>
       	<div>
       		<span><label for="horaTrabalhada">Valor da hora Trabalhada:</label></span>
       		<input type="text" name="horaTrabalhada" id="horaTrabalhada">
       	</div>
       	<div>
       		<input type="button" value="Atualizar custo hora" onclick="atualizaHora()" />
       	</div>
       	<div>
	       	<h2>Itens</h2>
	       	<table id="itens" border="1">
	       		<thead>
	       			<tr>
			       		<th>ID</th>
			       		<th>nome</th>
			       		<th>unidade</th>
			       		<th>custo</th>
			       		<th>Editar</th>
		       		</tr>
	       		</thead>
	       		<tbody>
	       		
	       		</tbody>
	       	</table>
	       	<br /><br />
	       	<div>
	       	<form id="formItem">
	       		<label>Cadastro Item</label><br />
	       		<label>Id Item</label>
	       		<div><input type="text" name="id" id="idItem" /></div>
	       		<label>Nome</label>
	       		<div><input type="text" name="nome" id="nomeItem" /></div>
	       		<label>Tipo Unidade</label>
	       		<div><select name="tipoUnidade" id="tipoUnidadeItem"><option>METRO</option><option>UNIDADE</option> </select></div>
	       		<label>Custo</label>
	       		<div><input type="text" name="custo" id="custoItem" /></div>
	       			<div>
		       		<input type="button" value="Cria Item" onclick="criaItem()" />
		       		<input type="button" value="Limpar Item" onclick="limparItem()" />
		       	</div>
	       	</form>
	       	</div>
       	</div>
       	<div>
	       	<h2>Produtos</h2>
	       	<table id="produtos" border="1">
	       		<thead>
	       			<tr>
			       		<th>ID</th>
			       		<th>nome</th>
			       		<th>horas trabalhadas</th>
			       		<th>custo total</th>
			       		<th>Editar</th>
		       		</tr>
	       		</thead>
	       		<tbody>
	       		
	       		</tbody>
	       	</table>
	       	<br /><br />
	       	<div>
	       	<form id="formProduto">
	       		<label>Cadastro de produtos</label><br />
	       		<label>Id Produto</label>
	       		<div><input type="text" name="id" id="idProduto" /></div>
	       		<label>Nome</label>
	       		<div><input type="text" name="nome" id="nomeProduto" /></div>
	       		<label>Horas trabalhadas</label>
	       		<div><input type="text" name="horasTrabalhadas" id="horasTrabalhadasProduto" /></div>
	       		<label>Custo</label>
                <div>
                    <select id="itensCombo" name="itensCombo" size="10">

                    </select>
                </div>
	       		<div>
		       		<input type="button" value="Cria Produto" onclick="criaProduto()" />
		       		<input type="button" value="Limpar Produto" onclick="limparProduto()" />
		       	</div>
	       	</form>
	       	</div>
       	</div>
    </body>
</html>